' Part of "Red Ink" (SharedLibrary)
' Copyright (c) LawDigital Ltd., Switzerland. All rights reserved. For license to use see https://redink.ai.'
'
' The compiled version of Red Ink also ...
'
' Includes DiffPlex in unchanged form; Copyright (c) 2023 Matthew Manela; licensed under the Apache-2.0 license (http://www.apache.org/licenses/LICENSE-2.0) at GitHub (https://github.com/mmanela/diffplex).
' Includes Newtonsoft.Json in unchanged form; Copyright (c) 2023 James Newton-King; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://www.newtonsoft.com/json
' Includes HtmlAgilityPack in unchanged form; Copyright (c) 2024 ZZZ Projects, Simon Mourrier,Jeff Klawiter,Stephan Grell; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://html-agility-pack.net/
' Includes Bouncycastle.Cryptography in unchanged form; Copyright (c) 2024 Legion of the Bouncy Castle Inc.; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://www.bouncycastle.org/download/bouncy-castle-c/
' Includes PdfPig in unchanged form; Copyright (c) 2024 UglyToad, EliotJones PdfPig, BobLd; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/UglyToad/PdfPig
' Includes MarkDig in unchanged form; Copyright (c) 2024 Alexandre Mutel; licensed under the BSD 2 Clause (Simplified) license (https://licenses.nuget.org/BSD-2-Clause) at https://github.com/xoofx/markdig
' Includes NAudio and components in unchanged form; Copyright (c) 2020 Mark Heath; licensed under a proprietary open source license (https://www.nuget.org/packages/NAudio/2.2.1/license) at https://github.com/naudio/NAudio
' Includes Vosk in unchanged form; Copyright (c) 2022 Alpha Cephei Inc.; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://alphacephei.com/vosk/
' Includes Whisper.net in unchanged form; Copyright (c) 2024 Sandro Hanea; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/sandrohanea/whisper.net
' Includes Grpc.core/Grpc.net in unchanged form; Copyright (c) 2023/2025 The gRPC Authors; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/grpc/grpc
' Includes Google Speech V1 library and related API libraries in unchanged form; Copyright (c) 2024 Google LLC; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/googleapis/google-cloud-dotnet
' Includes Google Protobuf in unchanged form; Copyright (c) 2025 Google Inc.; licensed under the BSD-3-Clause license (https://licenses.nuget.org/BSD-3-Clause) at https://github.com/protocolbuffers/protobuf
' Includes Google.Api in unchanged form; Copyright (c) 2025 Google LLC; licensed under the BSD-3-Clause license (https://licenses.nuget.org/BSD-3-Clause) at https://github.com/googleapis/gax-dotnet
' Includes Google.Apis in unchanged form; Copyright (c) 2025 Google LLC; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/googleapis/google-api-dotnet-client
' Includes Google.Longrunning in unchanged form; Copyright (c) 2025 Google LLC; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/googleapis/google-cloud-dotnet
' Includes MarkdownToRTF in modified form; Copyright (c) 2025 Gustavo Hennig; original licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/GustavoHennig/MarkdownToRtf
' Includes Nito.AsyncEx in unchanged form; Copyright (c) 2021 Stephen Cleary; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/StephenCleary/AsyncEx
' Includes NetOffice libraries in unchanged form; Copyright (c) 2020 Sebastian Lange, Erika LeBlanc; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/netoffice/NetOffice-NuGet
' Includes NAudio.Lame in unchanged form; Copyright (c) 2019 Corey Murtagh; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/Corey-M/NAudio.Lame
' Includes PdfiumViewer in unchanged form; Copyright (c) 2017 Pieter van Ginkel; licensed under the Apache 2.0 license (https://licenses.nuget.org/Apache-2.0) at https://github.com/pvginkel/PdfiumViewer
' Includes PDFsharp in unchanged form; Copyright (c) 2025 PDFSharp Team; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://docs.pdfsharp.net/
' Includes System.Interactive.Async in unchanged form; Copyright (c) 2025 by .NET Foundation and Contributors; licensed under the MIT license (https://licenses.nuget.org/MIT) at https://github.com/dotnet/reactive
' Includes also various Microsoft distributables and libraries copyrighted by Microsoft Corporation and available, among others, under the Microsoft EULA, the Visual Studio Community 2022 License and the MIT License (including Microsoft.Bcl.*, Microsoft.Extensions.*, System.*, System.Security.*, System.CodeDom, DocumentFormat.OpenXml.*, Microsoft.ml.*, CommunityToolkit.HighPerformance licensed under MIT License) (https://licenses.nuget.org/MIT); Copyright (c) 2016- Microsoft Corp.'
'
' The documentation of the individual files of the SharedLibrary is still ongoing and will be completed soon.
'
' =============================================================================
' Red Ink Shared Library - Architectural Overview
'
' Purpose:
'   Central reusable components for Office add-ins (Word, Excel, Outlook) and 
'   AI-assisted document features: text processing, embeddings, anonymization, 
'   UI, configuration, model orchestration, speech recognition, and web automation.
'
' Language: VB.NET (.NET Framework)
' Target: Microsoft Office VSTO Add-ins
'
' =============================================================================
' SUBSYSTEMS
' =============================================================================
'
' [Core\Clipboard]
'   NativeClipboard.vb              - P/Invoke wrappers for Win32 clipboard operations.
'   ClipboardHelper.vb              - High-level helper (safe open/close, format handling).
'   SharedMethods.ClipboardSnapshot - Capture current clipboard contents into a serializable snapshot.
'   SharedMethods.PutInClipboard    - Put structured content safely.
'   SharedMethods.StoreAndRestoreClipboard - RAII-style state preservation.
'
' [Core\Config]
'   SharedMethods.LoadConfig        - Reads config from INI files on disk/environment variables.
'   SharedMethods.Settings          - Strongly-typed settings accessors, defaults, and settings UI.
'                                     Includes ShowSettingsWindow, ShowVariableConfigurationWindow,
'                                     ShowExpertConfiguration, ShowAboutWindow, SwitchModels,
'                                     UpdateAppConfig, ResetLocalAppConfig, GetActiveConfigFilePath.
'   SharedContext.vb / ISharedContext - Cross-cutting context interface defining 150+ properties
'                                     for API keys (INI_APIKey, INI_APIKey_2), model configurations
'                                     (INI_Model, INI_Model_2, INI_Endpoint, INI_Temperature),
'                                     system prompts (40+ SP_* properties), OAuth2 settings
'                                     (INI_OAuth2*, TokenExpiry), ISearch settings (INI_ISearch_*),
'                                     library paths (INI_*Path, INI_*PathLocal), markup settings
'                                     (INI_MarkupMethod*, INI_MarkupDiffCap), and runtime state.
'
' [Core\LLM]
'   ModelConfig                     - Model metadata and configuration container.
'   ModelSelectorForm               - UI for single model selection.
'   MultiModelSelectorForm          - UI for multi-model selection strategy.
'   SharedMethods.MainLLM           - Primary orchestration for LLM model invocation.
'   SharedMethods.AlternateModels   - Fallback / multi-model strategy with secondary API support.
'   JsonTemplateFormatter           - Mustache-like template engine for structured JSON output
'                                     with loop support ({%for...%}...{%endfor%}), path selection
'                                     (JSONPath), HTML→Markdown conversion (html:, htmlnocr:, nocr:),
'                                     separator override, key-value mapping, source normalization.
'   MimeHelper                      - MIME type classification for assets.
'   ImageDecoder                    - Convert embedded images to suitable analysis forms.
'   SharedMethods.GoogleOAuthHelper - OAuth2 token handling for Google APIs.
'   SharedMethods.Signing           - Cryptographic signing operations using BouncyCastle.
'
' [Core\Texthandling]
'   SharedMethods.TextHandling      - Normalization, segmentation, cleaning, word counting.
'   SharedMethods.TextHandlingExcel - Excel-specific cell/range text extraction.
'   SharedMethods.Diff              - Diff operations built atop DiffPlex library.
'
' [Core\UI]
'   ProgressForm / ProgressBarModule / DPIProgressForm - Unified DPI-aware progress UI.
'   SharedMethods.Infobox           - User messages (info/warn/error) via ShowCustomMessageBox.
'   SharedMethods.Pane              - Docked pane logic for Office task panes.
'   SelectionFormSmall              - Lightweight selection dialog.
'   SplashScreen / SplashScreenWorks / SplashScreenCountDown - Startup and progress visuals.
'   SharedMethods.CustomForms       - Dynamic form generation (ShowCustomInputBox, ShowCustomYesNoBox,
'                                     ShowCustomWindow).
'   frmAIChat                       - Persistent chat interface form for conversational AI.
'
' [Core\Various]
'   SharedMethods.FileImporter      - File ingestion pipeline (PDF, DOCX, TXT via PdfPig/OpenXML).
'   SharedMethods.ProcessParameterPlaceholders - Placeholder expansion in user prompts with
'                                     parameter definitions ({parameterN=Description;Type;Default;
'                                     RangeOrOptions}), user input dialogs, type parsing (string,
'                                     integer, long, double, boolean), range clamping, display→code
'                                     mapping, JSON escaping.
'   SharedMethods.VarHelpers        - Generic variable utilities and environment expansion.
'
' [CommonFeatures\Embeddings]
'   EmbeddingStore.vb               - ONNX-based neural embedding store for semantic search.
'                                     Uses Sentence-Transformer models (all-MiniLM-L6-v2-onnx).
'                                     Features: IndexDocument, Search with cosine similarity,
'                                     configurable scope (all docs vs current doc).
'   EmbeddingStore_BagOfWords.vb    - Lightweight bag-of-words fallback for offline/simple scenarios.
'                                     Term frequency vectorization, stopword filtering, bigrams,
'                                     SimpleTokenizer, RebuildVectors.
'   MlNetTokenizer.vb               - SentencePiece/WordPiece tokenization wrapper using 
'                                     Microsoft.ML.Tokenizers. TokenizeToIds with padding/truncation,
'                                     TokenOffset tracking (Text, Start, End properties).
'   OnnxAnonymizer.vb               - ONNX-based Named Entity Recognition (NER) with selective
'                                     anonymization. BIO tagging (B-PER, I-PER, O), configurable
'                                     entity types whitelist, reversible placeholder generation.
'   TextChunk / TokenOffset / SearchResult - Data models for chunking, offsets, and search ranking.
'
' [CommonFeatures]
'   AnonymizationModule.vb          - Top-level anonymization workflow coordinator.
'                                     Reads redink-anon.txt config, supports modes (none/silent/ask/
'                                     askshow/show), types (0-4), regex patterns via PatternInfo
'                                     (RegexPattern, Prefix, GroupID), wildcards, {{prefix}} 
'                                     placeholders, re-identification via EntitiesMappings.
'   HelpMeInky.vb                   - Interactive "Help me, Inky!" assistant window.
'                                     WebBrowser-based chat UI, Markdown rendering via Markdig
'                                     (_mdPipeline), conversation history (_history), manual loading
'                                     from remote/local paths (GetManualOnceAsync, GetManualTextFreshAsync),
'                                     optional configuration file inclusion (GetConfigurationContent),
'                                     HTML sanitization (SanitizeConfigContent), LLM calls 
'                                     (CallHelpMeLlmAsync), welcome generation, chat persistence.
'   DiscussInky                     - Extended discussion interface for document analysis.
'   SharedMethods.MyStyleHelpers    - Styling helpers (fonts/colors/themes) with DefineMyStyle.
'   SharedMethods.PromptLibrary     - Reusable LLM prompt templates loaded from INI_PromptLibPath.
'   SharedMethods.TextFileEditor    - Text file manipulation operations.
'   UpdateHandler.vb                - VSTO update checking and installation with retry logic.
'                                     Constants: MaxDailyUpdateRetries (5), LogMaxBytes (120000),
'                                     LogMaxLines (2000), LogKeepLines (1500).
'                                     Features: CheckAndInstallUpdates, PeriodicCheckForUpdates,
'                                     RunVstoInstaller, SaveTimestamp, TrimLogFile.
'                                     Supports ClickOnce deployment, local VSTO installers,
'                                     periodic checks, user prompts (UIInvokePrompt, UIInvokeYesNo),
'                                     retry state management (GetRetryStateFromSettings, 
'                                     SetRetryStateToSettings, ResetRetryIfNewDay), trust zone
'                                     detection (GetUrlZoneName, IsTrustNotGranted), splash screens.
'   WebAgentInterpreter.vb          - JSON-based scripting engine for automated web tasks.
'                                     Top-level structure: meta, env (base_url, headers, secrets,
'                                     variables), steps array.
'                                     Commands: set_user_agent, set_headers, set_cookies, open_url,
'                                     wait, find, extract_text, extract_html, extract_attribute,
'                                     download_url, save_file, read_file, http_request, set_var,
'                                     template, delete_file, send_email_report, log, enable_dynamic,
'                                     array_push, if, foreach, render_report, llm/llm_analyze.
'                                     Features: Mustache templating (SimpleMustacheRender), condition
'                                     evaluation (EvalCondition: exists, ==, contains, ~=, ||),
'                                     retry/backoff, selector strategies (xpath/css/text/regex via
'                                     ResolveSelector, CssToXPath), dynamic content expansion
'                                     (ExpandDynamicContentAsync), auto link extraction 
'                                     (AutoExtractLinks), LLM result sanitization (SanitizeLlmResult,
'                                     ExtractFirstJsonStructure, TryParseJson), secret resolution,
'                                     debug logging (DebugLogStepStart/End, DebugSnapshot).
'   FactExtractionService.vb        - Multi-file structured fact extraction module.
'                                     Classes: ExtractionSchemaColumn (Name, Type), ExtractionRow,
'                                     FactExtractionAggregateResult (Schema, Rows, Errors, ProcessedFiles,
'                                     FailedFiles, FailedFileNames, SourceDirectory).
'                                     Features: RunFactExtractionAsync (batch file processing with
'                                     AI-driven JSON extraction), ParseSingleFileJson, ParseUserSchemaSpec,
'                                     MergeIntoAggregate (combines results across files with File column),
'                                     date normalization (ParseFlexibleDate, NormalizeDate supporting
'                                     ISO, dd.MM.yyyy, month names, year-only formats), date clamping
'                                     (ApplyDateClamps with From/To boundaries), SortAggregate,
'                                     GenerateSchemaFromAiAsync, BuildConstrainedSystemPrompt (fixed schema),
'                                     MergeRowsByKeyAsync (LLM-driven row consolidation by date or key),
'                                     FallbackMergeRowsGeneric, DetectSortColumnFromSpec.
'                                     Settings constants: Setting_ManualInstruction, Setting_DateColumns,
'                                     Setting_SortColumn, Setting_SortDirection, Setting_DoOcr,
'                                     Setting_DateClampFrom, Setting_DateClampTo, Setting_OutputLanguage,
'                                     Setting_DateOutputFormat.
'
' [InstallationWizard]
'   InitialConfig                   - First-run setup wizard.
'   AppConfigurationVariable        - Variable binding for configuration.
'
' [Interop]
'   WinAPI / WindowsWrapper / NativeMethods - Managed wrappers for Windows APIs.
'                                     SetForegroundWindow, FindWindow, GetForegroundWindow,
'                                     SetWindowPos, ShowWindow, AllowSetForegroundWindow,
'                                     GetWindowThreadProcessId, AttachThreadInput, EnumWindows,
'                                     IsWindowVisible, GetWindowText, GetCurrentThreadId.
'
' [Definitions]
'   SharedContext.vb                - Cross-cutting context implementing ISharedContext.
'                                     Holds all runtime state: API keys, endpoints, models,
'                                     system prompts (40+ SP_* properties), OAuth tokens, paths.
'                                     Instructions for adding new properties included in file header.
'   SharedMethods.Constants.vb      - Application-wide constants including:
'                                     - AN/AN2/AN3/AN4/AN5/AN7/AN8 naming constants 
'                                       ("Red Ink", "redink", URLs, "Inky")
'                                     - CopyrightNotice
'                                     - Trigger constants (NoThinkTrigger, RKModeTrigger1-3)
'                                     - WebAgent defaults (WebAgent_DefaultFromEMail/Name)
'                                     - ISearch limits (MaxTries, MaxMaxDepth, MaxResults, 
'                                       MaxSearchTimeout, DefTries, DefResults, DefMaxDepth,
'                                       DefSearchTimeout)
'                                     - Registry paths (RegPath_Base, RegPath_CodeBasis, 
'                                       RegPath_IniPath, RegPath_IniPrio)
'                                     - Regex separators (RegexSeparator1 "|||", RegexSeparator2 "§§§")
'                                     - Anonymization constants (AnonFile, AnonPlaceholder,
'                                       AnonPrefix, AnonSuffix)
'                                     - JSONCheckPrompt for JSON validation
'                                     - UI defaults (Default_PaneWidth, PromptLogCap)
'                                     - Default system prompts (Default_SP_Translate, Default_SP_Correct,
'                                       Default_SP_Improve, Default_SP_Shorten, Default_SP_Filibuster,
'                                       Default_SP_ArgueAgainst, Default_SP_InsertClipboard,
'                                       Default_SP_Summarize, Default_SP_FreestyleText/NoText,
'                                       Default_SP_MailReply, Default_SP_MailSumup/2,
'                                       Default_SP_SwitchParty, Default_SP_Anonymize, Default_SP_Rename,
'                                       Default_SP_Redact, Default_SP_CheckforII, Default_SP_Markup,
'                                       Default_SP_ExtractSchema, Default_SP_Extract,
'                                       Default_SP_MergeDateRows, Default_SP_RangeOfCells,
'                                       Default_SP_ParseFile, Default_SP_WriteNeatly,
'                                       Default_SP_Add_KeepFormulasIntact/KeepHTMLIntact/KeepInlineIntact,
'                                       Default_SP_Add_Bubbles/BubblesReply/BubblesExtract/Bubbles_Format,
'                                       Default_SP_Add_Batch, Default_SP_Add_Slides, Default_SP_BubblesExcel,
'                                       Default_SP_Add_Revisions, Default_SP_MarkupRegex,
'                                       Default_SP_ChatWord), SP_CleanTextPrompt for TTS preprocessing.
'                                     - Path dictionaries (DefaultINIPaths, HelperPaths, UpdatePaths)
'                                     - Remote URLs (Default_HelpMeInkyPath, ExcelHelperUrl,
'                                       WordHelperUrl, RemoteDefaultsUrl)
'                                     - LicenseText with all third-party attributions
'                                     - Licensing system constants:
'                                       NewHomeURL, BetaUpgradeInstructions, PrivateLicenseYears (5),
'                                       TestingPeriod (6 months), MaxLicenseYearsInFuture (5),
'                                       LicenseCheckDisabledYears (100), BetaEndDate, GracePeriodDays (5),
'                                       GracePeriodWarningIntervals (5), LicenseWarningDays array,
'                                       LicenseWarningInterval (5), BetaWarningNoUpgradeDays (7),
'                                       BetaWarningInterval (5), BetaWarningDays (3).
'                                     - Global license state: LicensedTill, LicenseStatus, LicenseUsers,
'                                       LicenseContact, LicenseNoWarning, LicenseCheckDisabled,
'                                       LicenseFromConfig.
'                                     - LicenseTypeInfo class with GetLicenseTypes(versionDate).
'                                     - IntelligentMergeCallback delegate.
'   SharedMethods.Constants.OwnBuild.UpdateURLs.vb
'                                   - Build-specific URL constants (partial class extension).
'                                     Uses conditional compilation (#If DEVELOP/PREVIEW) to define:
'                                     - AppsUrl: Base URL for application resources
'                                     - AppsUrlDir: Build-specific subdirectory ("/develop/",
'                                       "/apps/preview/", "/apps/ga/")
'                                     - VersionQualifier: Version suffix (" Develop", " Preview", "")
'                                     Separated to allow local build customization without
'                                     affecting shared repository code.
'   SharedMethods.Constants.OwnBuild.Security.vb
'                                   - Security-related constants (partial class extension).
'                                     Provides optional hardcoded values for:
'                                     - Int_CodeBasis: Encryption key (Private, string)
'                                     - alloweddomains: Permitted domain whitelist (Public, string)
'                                     When empty strings, values fall back to registry lookup
'                                     at RegPath_Base + RegPath_CodeBasis.
'                                     Separated from main Constants.vb for local security
'                                     configuration; should not commit secrets to repository.
'
' [Converter]
'   MarkdownToRtfConverter          - Modified upstream library (MarkdownToRTF) for RTF generation.
'
